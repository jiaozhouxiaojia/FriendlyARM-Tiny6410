<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [第8课-系统调用方式文件编程](#第8课-系统调用方式文件编程)
	- [课程索引](#课程索引)
	- [文件描述符](#文件描述符)
	- [函数学习-文件操作](#函数学习-文件操作)
	- [学习方法](#学习方法)
	- [打开文件open](#打开文件open)
		- [函数名](#函数名)
		- [函数原型](#函数原型)
		- [函数功能](#函数功能)
		- [头文件依赖](#头文件依赖)
		- [返回值](#返回值)
		- [参数说明](#参数说明)
		- [实例程序](#实例程序)
	- [创建文件-creat](#创建文件-creat)
		- [函数名](#函数名)
		- [函数原型](#函数原型)
		- [函数功能](#函数功能)
		- [头文件依赖](#头文件依赖)
		- [返回值](#返回值)
		- [参数pathname](#参数pathname)
		- [参数mode](#参数mode)
		- [实例程序](#实例程序)
	- [关闭文件](#关闭文件)
		- [函数名](#函数名)
		- [函数原型](#函数原型)
		- [函数功能](#函数功能)
		- [头文件依赖](#头文件依赖)
		- [返回值](#返回值)
		- [参数](#参数)
		- [实例程序](#实例程序)
	- [读文件](#读文件)
		- [函数名](#函数名)
		- [函数原型](#函数原型)
		- [函数功能](#函数功能)
		- [头文件依赖](#头文件依赖)
		- [返回值](#返回值)
		- [参数](#参数)
		- [实例程序](#实例程序)
	- [写文件](#写文件)
		- [函数名](#函数名)
		- [函数原型](#函数原型)
		- [函数功能](#函数功能)
		- [头文件依赖](#头文件依赖)
		- [返回值](#返回值)
		- [参数](#参数)
		- [实例程序](#实例程序)
	- [定位文件](#定位文件)
		- [文件读写指针](#文件读写指针)
		- [函数名](#函数名)
		- [函数原型](#函数原型)
		- [函数功能](#函数功能)
		- [头文件依赖](#头文件依赖)
		- [返回值](#返回值)
		- [参数](#参数)
		- [实例程序](#实例程序)
	- [复制文件描述符](#复制文件描述符)
		- [函数名](#函数名)
		- [函数原型](#函数原型)
		- [函数功能](#函数功能)
		- [头文件依赖](#头文件依赖)
		- [返回值](#返回值)
		- [参数](#参数)
		- [实例程序](#实例程序)
	- [综合实例-实现文件复制cp](#综合实例-实现文件复制cp)
		- [打开源文件](#打开源文件)
		- [打开目标文件](#打开目标文件)
		- [读取源文件数据写入目标文件](#读取源文件数据写入目标文件)
		- [关闭文件描述符](#关闭文件描述符)
		- [运行测试](#运行测试)
	- [总结](#总结)

<!-- /TOC -->
# 第8课-系统调用方式文件编程

## 课程索引

![1527741526672.png](image/1527741526672.png)

## 文件描述符

![1527741545056.png](image/1527741545056.png)

      性质：就是一串数字，每个进程都有一组文件描述符。也就是说不通进程编号可以一样。
      典型的标准描述符0,1,2
      0-标准输入
      1-标准输出
      2-标准错误

## 函数学习-文件操作

![1527741570726.png](image/1527741570726.png)

      掌握学习方法

## 学习方法

![1527741682350.png](image/1527741682350.png)

## 打开文件open

### 函数名

![1527741769743.png](image/1527741769743.png)

![1527741808511.png](image/1527741808511.png)

![1527741819513.png](image/1527741819513.png)

### 函数原型

![1527741839856.png](image/1527741839856.png)

### 函数功能

![1527741884028.png](image/1527741884028.png)

### 头文件依赖

![1527741904241.png](image/1527741904241.png)

### 返回值

![1527741918919.png](image/1527741918919.png)

      成功返回文件描述符，失败返回-1

### 参数说明

![1527741994964.png](image/1527741994964.png)

![1527742025301.png](image/1527742025301.png)

      必须包含三个权限中的一个。当然其他标志可选包含
      O_APPEND:以追加形式打开文件
      O_CREAT:如果打开文件不存在则创建文件。如果设定了就必须有第三个参数，设定文件权限，同chmod

![1527742237719.png](image/1527742237719.png)

![1527742429846.png](image/1527742429846.png)

### 实例程序

![1527742611877.png](image/1527742611877.png)

![1527742657324.png](image/1527742657324.png)

![1527742776484.png](image/1527742776484.png)

![1527742767987.png](image/1527742767987.png)

## 创建文件-creat

### 函数名

![1527742826620.png](image/1527742826620.png)

### 函数原型

![1527742889227.png](image/1527742889227.png)

      与open公用一个说明手册

![1527742917257.png](image/1527742917257.png)

### 函数功能

创建一个文件并以flag方式操作文件

### 头文件依赖

![1527742979843.png](image/1527742979843.png)

### 返回值

![1527742995858.png](image/1527742995858.png)

      成功返回文件描述符，失败返回-1

### 参数pathname

      创建的文件名-包含路径

### 参数mode

      创建文件的读写权限

### 实例程序

![1527743393268.png](image/1527743393268.png)

![1527743408360.png](image/1527743408360.png)

## 关闭文件

### 函数名

![1527743549833.png](image/1527743549833.png)

### 函数原型

![1527743559449.png](image/1527743559449.png)

### 函数功能

      关闭文件描述符

### 头文件依赖

![1527743574295.png](image/1527743574295.png)

### 返回值

![1527743582104.png](image/1527743582104.png)

### 参数

![1527743611551.png](image/1527743611551.png)

      fd为待关闭的文件描述符

![1527743700681.png](image/1527743700681.png)

### 实例程序

![1527743711049.png](image/1527743711049.png)

## 读文件

### 函数名

![1527743738219.png](image/1527743738219.png)

### 函数原型

![1527743956607.png](image/1527743956607.png)

      指定章节

![1527744002039.png](image/1527744002039.png)

### 函数功能

![1527744043849.png](image/1527744043849.png)

      从一个打开的文件读取数据

### 头文件依赖

![1527744077362.png](image/1527744077362.png)

### 返回值

![1527744067711.png](image/1527744067711.png)

### 参数

      fd:要读取的文件描述符
      buf:提供的缓冲区
      count:指定读取大小

![1527744105358.png](image/1527744105358.png)

      从哪里开始读？

![1527744170919.png](image/1527744170919.png)

### 实例程序

![1527744206051.png](image/1527744206051.png)

![1527744239575.png](image/1527744239575.png)

## 写文件

### 函数名

![1527744250968.png](image/1527744250968.png)

### 函数原型

![1527744271063.png](image/1527744271063.png)

![1527744278815.png](image/1527744278815.png)

      原型跟read极度相似

### 函数功能

      给定文件描述符写入buf的count字节

### 头文件依赖

![1527744322627.png](image/1527744322627.png)

### 返回值

![1527744342679.png](image/1527744342679.png)

      返回写入字节数，失败固定-1

### 参数

      fd:要写入的文件描述符
      buf:提供的缓冲区
      count:指定从buf写入数据大小

### 实例程序

![1527744452175.png](image/1527744452175.png)

![1527744468517.png](image/1527744468517.png)

![1527744510983.png](image/1527744510983.png)

## 定位文件

### 文件读写指针

      文件游标，随着读写移动。当前文件偏移量

### 函数名

![1527744649013.png](image/1527744649013.png)

### 函数原型

![1527744670828.png](image/1527744670828.png)

### 函数功能

![1527744691246.png](image/1527744691246.png)

      重新定位文件读写位置

### 头文件依赖

![1527744710709.png](image/1527744710709.png)

### 返回值

![1527744751645.png](image/1527744751645.png)

      返回偏移位置，距离文件头的位置，非负数
      错误返回-1

### 参数

      fd:要写入的文件描述符
      offset:
      whence:提供的缓冲区

![1527744818869.png](image/1527744818869.png)

      SEEK_SET:以offset为准，或者说从文件头开始
      SEEK_CUR:以当前位置+/-offset为准
      SEEK_END:以文件结尾-offset为准，应该为负数，不然返回错误

有offset和whence共同决定偏移指针
offset可正可负，向前移，向后移

### 实例程序

![1527749434060.png](image/1527749434060.png)

![1527749454547.png](image/1527749454547.png)

## 复制文件描述符

### 函数名

![1527749481546.png](image/1527749481546.png)

### 函数原型

![1527749563480.png](image/1527749563480.png)

### 函数功能

![1527749572793.png](image/1527749572793.png)
      复制文件描述符

### 头文件依赖

![1527749593352.png](image/1527749593352.png)

### 返回值

![1527749602784.png](image/1527749602784.png)

### 参数

![1527749639297.png](image/1527749639297.png)

![1527749656746.png](image/1527749656746.png)

### 实例程序

![1527749679331.png](image/1527749679331.png)

![1527749696977.png](image/1527749696977.png)

## 综合实例-实现文件复制cp

![1527749842192.png](image/1527749842192.png)

      需要两个参数

![1527749896051.png](image/1527749896051.png)

![1527749954185.png](image/1527749954185.png)

### 打开源文件

![1527750064971.png](image/1527750064971.png)

### 打开目标文件

![1527750075056.png](image/1527750075056.png)

### 读取源文件数据写入目标文件

![1527750145328.png](image/1527750145328.png)

### 关闭文件描述符

![1527750160529.png](image/1527750160529.png)

### 运行测试

![1527750179757.png](image/1527750179757.png)

![1527750221480.png](image/1527750221480.png)

![1527750238512.png](image/1527750238512.png)

![1527750228657.png](image/1527750228657.png)

      拷贝多了，应该写入读取的字节数，而不是固定512字节，改改源码就可以了

![1527750275213.png](image/1527750275213.png)



## 总结

      《UNIX环境高级编程》结合man手册编程

![1527742135100.png](image/1527742135100.png)

      man分章节
      1、所有用户可以使用的命令
      2、系统内核调用，不是每个命令都有系统调用（如：man 2 read）
      3、库调用
      4、特殊文件，如：/dev/tty1
      5、文件格式（命令配置文件的语法，如：man 5 passwd）
      6、游戏相关
      7、杂项
      8、管理员命令，如：fdisk
      man chapter
      1、Standard commands （标准命令）
      2、System calls （系统调用）
      3、Library functions （库函数）
      4、Special devices （设备说明）
      5、File formats （文件格式）
      6、Games and toys （游戏和娱乐）
      7、Miscellaneous （杂项）
      8、Administrative Commands （管理员命令）
