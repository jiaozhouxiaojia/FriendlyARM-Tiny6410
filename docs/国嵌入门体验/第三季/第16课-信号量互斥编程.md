<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [第16课-信号量互斥编程](#第16课-信号量互斥编程)
	- [课程索引](#课程索引)
	- [问题引入-资源访问混乱](#问题引入-资源访问混乱)
	- [解决方案](#解决方案)
	- [信号量](#信号量)
	- [信号量分类](#信号量分类)
	- [函数学习](#函数学习)
	- [学习方法](#学习方法)
	- [打开/创建信号量semget](#打开创建信号量semget)
		- [函数名称](#函数名称)
		- [函数原型](#函数原型)
		- [函数功能](#函数功能)
		- [头文件](#头文件)
		- [返回值](#返回值)
		- [参数](#参数)
	- [键值](#键值)
	- [ftok工作原理](#ftok工作原理)
	- [操作信号量semop](#操作信号量semop)
		- [函数名称](#函数名称)
		- [函数原型](#函数原型)
		- [函数功能](#函数功能)
		- [头文件](#头文件)
		- [返回值](#返回值)
		- [参数](#参数)
		- [综合编程实例](#综合编程实例)
	- [总结](#总结)

<!-- /TOC -->
# 第16课-信号量互斥编程

## 课程索引

![1527829592254.png](image/1527829592254.png)

      提出问题，引入解决方案，解决问题

## 问题引入-资源访问混乱

![1527829758391.png](image/1527829758391.png)

      问题程序化

![1527829833295.png](image/1527829833295.png)

![1527829902759.png](image/1527829902759.png)

![1527829939588.png](image/1527829939588.png)

![1527829987689.png](image/1527829987689.png)

## 解决方案

      互斥访问-标志牌？
        互相排斥-信号量
          实质就是一个数字
      获取信号量 1 -> 0
      释放信号量 0 -> 1

## 信号量

![1527830270898.png](image/1527830270898.png)

## 信号量分类

![1527830286679.png](image/1527830286679.png)

## 函数学习

![1527830296362.png](image/1527830296362.png)

## 学习方法

![1527830305322.png](image/1527830305322.png)

## 打开/创建信号量semget

      区别于文件编程

![1527830366455.png](image/1527830366455.png)

### 函数名称

![1527830389315.png](image/1527830389315.png)

### 函数原型

![1527830406292.png](image/1527830406292.png)

### 函数功能

![1527830422202.png](image/1527830422202.png)

      获取信号量集合的标识符

![1527830542793.png](image/1527830542793.png)

### 头文件

![1527830413168.png](image/1527830413168.png)

### 返回值

![1527830494548.png](image/1527830494548.png)

      信号量集合的标识符

### 参数

![1527831635237.png](image/1527831635237.png)

## 键值

![1527831302959.png](image/1527831302959.png)

      类比文件操作，通过文件名操作文件
      信号量通过键值找到ipc对象

![1527831368748.png](image/1527831368748.png)

      创建信号量时指定键值

![1527831392958.png](image/1527831392958.png)

      ftok选择

## ftok工作原理

![1527831456566.png](image/1527831456566.png)

      把文件名及inode组合项目id构成键值

![1527831509725.png](image/1527831509725.png)

      如果没有与之对应的信号量时，如果指明IPC_CREAT则创建信号量


## 操作信号量semop

### 函数名称

![1527831702295.png](image/1527831702295.png)

### 函数原型

![1527831714576.png](image/1527831714576.png)

### 函数功能

![1527831725021.png](image/1527831725021.png)

### 头文件

![1527831719405.png](image/1527831719405.png)

### 返回值

![1527836539839.png](image/1527836539839.png)

### 参数

![1527836693684.png](image/1527836693684.png)
      操作信号量集合中的信号量

### 综合编程实例

      每个信号量都有键值对应
        键值=文件名+项目id

![1527836972783.png](image/1527836972783.png)

![1527837102141.png](image/1527837102141.png)

![1527837129381.png](image/1527837129381.png)


![1527837246269.png](image/1527837246269.png)

![1527837260205.png](image/1527837260205.png)

      信号量初始值需要自己设定

![1527837339696.png](image/1527837339696.png)

![1527837373612.png](image/1527837373612.png)

![1527837419315.png](image/1527837419315.png)

![1527837447474.png](image/1527837447474.png)

![1527837463767.png](image/1527837463767.png)

## 总结

      信号量组形式
      必须自己设定初始值
      有获取就必须有释放-避免死锁

![1527837511677.png](image/1527837511677.png)
