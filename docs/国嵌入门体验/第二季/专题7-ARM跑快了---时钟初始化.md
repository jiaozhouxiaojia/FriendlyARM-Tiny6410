<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [专题7-ARM跑快了---时钟初始化](#专题7-arm跑快了-时钟初始化)
	- [课程索引](#课程索引)
	- [概念解析](#概念解析)
		- [时钟脉冲信号](#时钟脉冲信号)
		- [时钟脉冲频率](#时钟脉冲频率)
		- [时钟信号的产生](#时钟信号的产生)
	- [时钟体系](#时钟体系)
		- [S3C2440](#s3c2440)
		- [S3C6410](#s3c6410)
		- [S5PV210](#s5pv210)
	- [思维导图设计](#思维导图设计)
		- [2440](#2440)
		- [2440 初始化时钟](#2440-初始化时钟)
	- [代码书写](#代码书写)
		- [2440](#2440)
			- [设置LockTime](#设置locktime)
			- [设置分频系数](#设置分频系数)
			- [设置异步工作模式](#设置异步工作模式)
			- [设置PCLK FCLK HCLK](#设置pclk-fclk-hclk)
			- [编译运行](#编译运行)
		- [6410](#6410)
			- [设置LockTime](#设置locktime)
			- [设置分频系数](#设置分频系数)
			- [设置异步工作模式](#设置异步工作模式)
			- [设置PCLK FCLK HCLK](#设置pclk-fclk-hclk)
			- [编译运行](#编译运行)
		- [210](#210)
			- [设置LockTime](#设置locktime)
			- [设置分频系数](#设置分频系数)
			- [设置异步工作模式](#设置异步工作模式)
			- [设置PCLK FCLK HCLK](#设置pclk-fclk-hclk)
			- [编译运行](#编译运行)
	- [总结](#总结)

<!-- /TOC -->

# 专题7-ARM跑快了---时钟初始化

## 课程索引

![1526366385668.png](image/1526366385668.png)


## 概念解析

![1526366451296.png](image/1526366451296.png)

### 时钟脉冲信号

      谁来提醒你到点了，该干啥。饭点，觉点，醒点......

![1526366468860.png](image/1526366468860.png)

      提供时间度量的工具

![1526366476817.png](image/1526366476817.png)

### 时钟脉冲频率

      单位时间，单位到什么程序？
      假设时间是1S，如果有25个脉冲，那么单位时间25个脉冲

![1526366495391.png](image/1526366495391.png)

### 时钟信号的产生

      晶振
      锁相环

![1526366521335.png](image/1526366521335.png)

![1526366531192.png](image/1526366531192.png)

![1526367204311.png](image/1526367204311.png)

      压电效应 - 晶体振荡器
      石英晶体常被用来制作振荡器，在电子线路中充当信号源。
      石英晶体的固有频率只与晶片的几何尺寸（包括晶体切割的方位，大小和形状）有关，其精度高而稳定，因此是一种最理想的振荡源材料。
      石英晶体振荡器制作工艺简单，制作成本很低。只要在石英晶片的两个面上各喷涂一层银(或金)，然后引出电极并加以封装，就构成了一个石英晶体振荡器。

![1526366539194.png](image/1526366539194.png)

![1526366544905.png](image/1526366544905.png)

      通过晶体振荡器之后再有锁相环加倍频率
      可以更加灵活，通过寄存器配置，可以使频率不同

![1526367344509.png](image/1526367344509.png)

![1526366551219.png](image/1526366551219.png)



## 时钟体系

![1526366561286.png](image/1526366561286.png)

### S3C2440

![1526367538399.png](image/1526367538399.png)

      S3C2440芯片手册
      了解一个处理器时钟体系，大同小异，了解一下内容
      1.了解晶振频率
      2.了解时钟里面有多少个PLL？
      3.这些PLL分别产生哪些时钟？
      4.这些时钟分别用来做什么？

![1526366582439.png](image/1526366582439.png)

      1.12Mhz晶振
      2.MPLL、UPLL
      3.MPLL 产生FCLK、HCLK、PCLK
        UPLL 产生UCLK
      4.用来做什么？看下面表格

![1526366591847.png](image/1526366591847.png)

### S3C6410

      S3C6410芯片手册
      了解一个处理器时钟体系，大同小异，了解一下内容
      1.了解晶振频率 12Mhz晶振
      2.了解时钟里面有多少个PLL？3个PLL
      3.这些PLL分别产生哪些时钟？
          APLL:ARMCLK
          MPLL:HCLK,PCLK
          EPLL:SCLK
      4.这些时钟分别用来做什么？
          ARMCLK
          HCLK
          PCLK
          SCLK

![1526366608863.png](image/1526366608863.png)

![1526366615194.png](image/1526366615194.png)

![1526366620201.png](image/1526366620201.png)

### S5PV210

      S5PV210芯片手册
      了解一个处理器时钟体系，大同小异，了解一下内容
      1.了解晶振频率 24Mhz晶振
      2.了解时钟里面有多少个PLL？4个PLL
      3.这些PLL分别产生哪些时钟？
					APLL
					MPLL
					EPLL
					VPLL
					210还有时钟分类MSYS、DSYS、PSYS
      4.这些时钟分别用来做什么？

![1526434289402.png](image/1526434289402.png)

![1526366665177.png](image/1526366665177.png)

![1526366670759.png](image/1526366670759.png)

## 思维导图设计

			利用芯片手册的时序图，得到软件设计流程

![1526366679135.png](image/1526366679135.png)

![1526366692632.png](image/1526366692632.png)

### 2440

![1526434465751.png](image/1526434465751.png)

			FCLK提供给ARM核使用，工作在多少Mhz。上电后频率是按照晶振速度工作。比较慢。需要用软件配置PLL让处理器达到比较高的工作频率。
			当完成锁相环的配置时，处理器会处于一段时间lock time，不工作了，之后才开始按照新的频率进行工作。
			从低频率到高频率需要软件做什么？
				lock time可以配置么？
				PLL怎么设置?

* 配置Lock time
* 设置分频系数
* 配置FCLK
* 配置HCLK FCLK/2分频
* 配置PCLK FCLK/4分频
* 如果FCLK！= HCLK，设置CPU为异步模式(FCLK为核频率，HCLK为总线频率)

![1526434994624.png](image/1526434994624.png)

			带条件执行：总线工作模式切换到异步模式
			什么是HDIVN？

![1526435048434.png](image/1526435048434.png)

			FCLK为核频率，HCLK为总线频率。当频率不同的时候需要让其在异步工作模式。
			简单地说，根本不会让两者频率一致，太慢了。所以必须要设置异步模式


### 2440 初始化时钟

![1526435217948.png](image/1526435217948.png)


## 代码书写


### 2440

#### 设置LockTime

![1526435310515.png](image/1526435310515.png)

			可以设置为默认值，不去管它，不写代码

#### 设置分频系数

			比例关系FCLK、HCLK、PCLK不是任意的。按表格来，如何选择呢？
			根据Uboot参考，查看Uboot怎么设置系统

![1526435486349.png](image/1526435486349.png)

![1526435552562.png](image/1526435552562.png)

			还需要设置HDIV、PDIV，如何设置这两个系数？

![1526435614295.png](image/1526435614295.png)

![1526435666472.png](image/1526435666472.png)

#### 设置异步工作模式

			这里调整一下，必须马上设置CPU工作在异步模式

![1526435867922.png](image/1526435867922.png)

![1526435912676.png](image/1526435912676.png)

			直接抄上面给出的设置工作在异步工作模式的代码

![1526435990262.png](image/1526435990262.png)

#### 设置PCLK FCLK HCLK

			假设FCLK，输出频率是405.00MHz

![1526436073392.png](image/1526436073392.png)

![1526436096178.png](image/1526436096178.png)

			不使用公式，直接利用快查表就可以了

![1526436233675.png](image/1526436233675.png)

![1526436348297.png](image/1526436348297.png)

![1526436376246.png](image/1526436376246.png)


#### 编译运行

			编译运行，LED被点亮就说明ok了

![1526436439990.png](image/1526436439990.png)

### 6410

![1526436511205.png](image/1526436511205.png)

#### 设置LockTime

			LockTime分别有三个需要设置。APLL MPLL EPLL
			可以保持默认值不变

#### 设置分频系数

			通过晶振不断分频得到的

![1526436616491.png](image/1526436616491.png)

![1526436818553.png](image/1526436818553.png)

			DIVarm就是分频

![1526436850049.png](image/1526436850049.png)

			ARMclk = APLLout/(DIVarm+1)

![1526437018459.png](image/1526437018459.png)

![1526437215527.png](image/1526437215527.png)

			各种参考Uboot

![1526437278740.png](image/1526437278740.png) 


#### 设置异步工作模式

#### 设置PCLK FCLK HCLK

#### 编译运行



### 210

#### 设置LockTime

#### 设置分频系数

#### 设置异步工作模式

#### 设置PCLK FCLK HCLK

#### 编译运行



## 总结
