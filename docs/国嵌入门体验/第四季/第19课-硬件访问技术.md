<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [第19课-硬件访问技术](#第19课-硬件访问技术)
	- [课程索引](#课程索引)
	- [硬件访问实质](#硬件访问实质)
	- [访问流程](#访问流程)
	- [地址映射](#地址映射)
		- [动态映射ioremap](#动态映射ioremap)
		- [静态映射](#静态映射)
			- [映射关系map_desc](#映射关系mapdesc)
			- [S3C系列map_desc数组](#s3c系列mapdesc数组)
	- [使用静态映射改写LED驱动](#使用静态映射改写led驱动)
	- [寄存器读写相关函数](#寄存器读写相关函数)
	- [总结](#总结)

<!-- /TOC -->
# 第19课-硬件访问技术

## 课程索引

![1526784114518.png](image/1526784114518.png)

## 硬件访问实质

![1526784147427.png](image/1526784147427.png)

      通过内部寄存器达到访问目的。
      访问硬件==访问寄存器

## 访问流程

![1526785035705.png](image/1526785035705.png)

## 地址映射

      内存管理子系统中，非常重要的原则，不管是内核程序还是应用程序
      使用的地址必须是虚拟地址。
      但是芯片手册等都是直接告诉物理地址，那该如何使用？
      必须要经过转换，物理地址转换为虚拟地址才可以用。这个过程就是地址映射。
      两种方式地址映射，
      1.动态映射
      2.静态映射。

### 动态映射ioremap

![1526785142097.png](image/1526785142097.png)

![1526785237871.png](image/1526785237871.png)

### 静态映射

![1526785290271.png](image/1526785290271.png)

#### 映射关系map_desc

![1526785370311.png](image/1526785370311.png)

      物理地址所在的页帧号，因为是按照页来操作的。

![1526785476328.png](image/1526785476328.png)

      物理地址到页帧号的转换_phys_to_pfn

#### S3C系列map_desc数组

![1526785553618.png](image/1526785553618.png)

![1526785591647.png](image/1526785591647.png)

![1526785598990.png](image/1526785598990.png)

      内核启动时完成相关映射

![1526785670261.png](image/1526785670261.png)


## 使用静态映射改写LED驱动

![1526785792615.png](image/1526785792615.png)

      获取到GPIO配置虚拟地址

![1526785810309.png](image/1526785810309.png)

![1526785820805.png](image/1526785820805.png)

      直接使用该宏

![1526785841429.png](image/1526785841429.png)

![1526785861366.png](image/1526785861366.png)

      头文件去哪里找？内核里面相关的直接拷贝

![1526785899215.png](image/1526785899215.png)

![1526785907038.png](image/1526785907038.png)

![1526785961542.png](image/1526785961542.png)

![1526785968900.png](image/1526785968900.png)

![1526785973340.png](image/1526785973340.png)

![1526785981604.png](image/1526785981604.png)

## 寄存器读写相关函数

![1526786011263.png](image/1526786011263.png)

## 总结

      静态映射，动态映射哪个合适？？
