<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [第7课-嵌入式Linux内核制作](#第7课-嵌入式linux内核制作)
	- [嵌入式系统构成](#嵌入式系统构成)
	- [内核制作步骤](#内核制作步骤)
		- [平台配置文件.conf](#平台配置文件conf)
		- [交叉编译](#交叉编译)
	- [总结](#总结)

<!-- /TOC -->
# 第7课-嵌入式Linux内核制作

## 嵌入式系统构成

![1526609592988.png](image/1526609592988.png)

## 内核制作步骤

![1526609619802.png](image/1526609619802.png)

![1526609627178.png](image/1526609627178.png)

### 平台配置文件.conf

![1526609776913.png](image/1526609776913.png)

      拷贝对应源码到宿主机，然后解包
      使用提供的config文件，重命名成.conf

![1526609690787.png](image/1526609690787.png)

      在ARM平台需要配置参数ARCH=arm
      在MIPS平台需要配置参数ARCH=mips
      make menuconfig ARCH=arm就会列出默认的通用的arm配置文件。
      当然我们不用它，使用官方给的比较靠谱。
      其实你一开始用官方的.conf文件都可以不用执行make menuconfig
      改命令其实就只影响.conf文件而已，不影响其他。

![1526609856146.png](image/1526609856146.png)

![1526609952767.png](image/1526609952767.png)

### 交叉编译

      make uImage 嵌入式平台内核镜像比较小，x86就要用bzImage毕竟比较大
      还要指定交叉工具链
      大概持续5分钟左右

![1526610117470.png](image/1526610117470.png)

      错误？为何
      UBoot可执行文件都要在文件有文件头，文件头就是mkimage工具添加
      mkimage是在UBoot代码中，可能你改了UBoot相关加载程序的代码，不能使用通用mkimage，因此你需要列出来。
      把mkimage拷贝到/bin目录下即可

![1526610077403.png](image/1526610077403.png)

![1526610593826.png](image/1526610593826.png)

      运行一下试试

![1526610624594.png](image/1526610624594.png)

![1526610658024.png](image/1526610658024.png)

      kernel panic。但是最后在挂载根文件系统的时候出错了，因为找不到根文件系统

![1526610684354.png](image/1526610684354.png)

## 总结
