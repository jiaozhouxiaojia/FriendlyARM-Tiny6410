# 第17课-字符设备控制

## 课程索引

![1526780452265.png](image/1526780452265.png)

      其实就是讲ioctl相关函数

## 设备控制理论

![1526780493615.png](image/1526780493615.png)

### 控制理论-作用

![1526780509962.png](image/1526780509962.png)

### 设备控制-应用函数

      读取设备用read
      写入数据用write
      控制设备用ioctl

![1526780527856.png](image/1526780527856.png)

      省略号参数取决于cmd命令
      其实就是可变参数的形式。

### 设备控制-驱动函数

      版本不同，调用函数不同，这。。。兼容性完美！

![1526780541482.png](image/1526780541482.png)

## 设备控制实现

![1526780554697.png](image/1526780554697.png)

### 控制实现-定义命令

![1526781171814.png](image/1526781171814.png)

![1526780566167.png](image/1526780566167.png)

![1526780572833.png](image/1526780572833.png)

### 设备控制-实现操作

      switch编程模型，根据不同命令执行不同操作。

![1526780586304.png](image/1526780586304.png)

## 自动动手写驱动

      两个命令：
      1.重启设备
      2.参数设定
      命令一般放在头文件中。定义幻数

### 定义命令

![1526781706853.png](image/1526781706853.png)

![1526781790412.png](image/1526781790412.png)

![1526781826692.png](image/1526781826692.png)

![1526781833642.png](image/1526781833642.png)

### 设备ioctl实现

![1526781892267.png](image/1526781892267.png)

![1526781906907.png](image/1526781906907.png)

### 应用程序编写

![1526781933860.png](image/1526781933860.png)

![1526781984619.png](image/1526781984619.png)

      ioctl有没有第三个参数取决于第二个参数。
      包含头文件，man一下就知道了

![1526782006129.png](image/1526782006129.png)

![1526782023322.png](image/1526782023322.png)

![1526782033082.png](image/1526782033082.png)

![1526782054321.png](image/1526782054321.png)

      静态编译

![1526782064370.png](image/1526782064370.png)

![1526782083936.png](image/1526782083936.png)

![1526782088080.png](image/1526782088080.png)

![1526782094348.png](image/1526782094348.png)

![1526782100016.png](image/1526782100016.png)

## 总结
