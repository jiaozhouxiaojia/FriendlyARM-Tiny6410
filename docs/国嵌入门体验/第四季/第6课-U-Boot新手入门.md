<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [第6课-U-Boot新手入门](#第6课-u-boot新手入门)
	- [课程索引](#课程索引)
	- [嵌入式软件层次](#嵌入式软件层次)
	- [编译U-Boot](#编译u-boot)
		- [配置UBoot](#配置uboot)
		- [编译UBoot](#编译uboot)
	- [UBoot烧写](#uboot烧写)
	- [UBoot命令详解](#uboot命令详解)
		- [UBoot帮助命令](#uboot帮助命令)
		- [UBoot环境变量相关命令](#uboot环境变量相关命令)
		- [UBoot程序下载命令](#uboot程序下载命令)
		- [UBoot内存操作命令](#uboot内存操作命令)
		- [UBoot Flash操作命令](#uboot-flash操作命令)
		- [UBoot程序执行命令](#uboot程序执行命令)
		- [UBoot设置自动启动](#uboot设置自动启动)
	- [总结](#总结)

<!-- /TOC -->

# 第6课-U-Boot新手入门

## 课程索引

![1526547130545.png](image/1526547130545.png)

      如何使用UBoot，如何二次开发

## 嵌入式软件层次

![1526547206242.png](image/1526547206242.png)

      一步一步来，然后就可以自己在开发板搭建一个完整的嵌入式系统

## 编译U-Boot

![1526547532471.png](image/1526547532471.png)

![1526547505921.png](image/1526547505921.png)

      找到对应开发板的Uboot。拷贝到samba服务器，解压缩

![1526547585672.png](image/1526547585672.png)

### 配置UBoot

      首先要配置。源码可以编译成N多个开发板，但是最终运行只能在一个开发板上运行。
      在Makefile中列出了一大波配置，找到自己开发板的配置项，然后make 该配置项

![1526547734530.png](image/1526547734530.png)

![1526547764267.png](image/1526547764267.png)

### 编译UBoot

      指定架构，编译器，编译大概持续2分钟左右的时间

![1526547822548.png](image/1526547822548.png)

![1526547925678.png](image/1526547925678.png)

![1526548012946.png](image/1526548012946.png)

      uboot.bin就是可以烧写的二进制映像

## UBoot烧写

      烧写到NandFlash

![1526547548184.png](image/1526547548184.png)

      烧写前都要格式化一下

![1526548206711.png](image/1526548206711.png)

![1526548228404.png](image/1526548228404.png)

      可以看到UBoot菜单

![1526548241020.png](image/1526548241020.png)

      输入q退出快速选择菜单，进入命令行
      这个其实跟grub一回事儿。grub也有命令行

![1526548264758.png](image/1526548264758.png)



## UBoot命令详解

![1526548343572.png](image/1526548343572.png)

### UBoot帮助命令

![1526548425039.png](image/1526548425039.png)

![1526548548272.png](image/1526548548272.png)

### UBoot环境变量相关命令

![1526548436219.png](image/1526548436219.png)

![1526548825114.png](image/1526548825114.png)

![1526548874881.png](image/1526548874881.png)

      print = printenv
      输入当个环境变量名，可查看其值。如果存在的话

![1526548564927.png](image/1526548564927.png)

![1526548958767.png](image/1526548958767.png)

			setenv 可以修改也可以删除环境变量

![1526607825624.png](image/1526607825624.png)

			saveenv 保存环境变量到Flash中，重启开发板依然有效

### UBoot程序下载命令

			不建议使用串口，太慢了。通常使用网络方式
			USB驱动要求，串口慢，就剩网络了

![1526608034367.png](image/1526608034367.png)

			保证网络链路畅通，设定开发板MAC地址，ip地址。保持一个网段
			作为tftp客户端，宿主机作为tftp服务器端

![1526608187439.png](image/1526608187439.png)

![1526608212396.png](image/1526608212396.png)

			windows、虚拟机、开发板尽可能放到同一个网段。
			关闭防火墙。。其实挺傻的操作。
			虚拟机桥接方式，不使用NAT
			开发板接到交换机、路由器上

![1526608300320.png](image/1526608300320.png)

![1526608440669.png](image/1526608440669.png)

![1526608480983.png](image/1526608480983.png)

			没有开MMU地址一般是根据开发板不同 2,3,5开头，开了MMU就是0xC...

![1526608695437.png](image/1526608695437.png)

### UBoot执行程序

![1526608081073.png](image/1526608081073.png)

![1526608747219.png](image/1526608747219.png)

			执行固定格式的二进制程序
				程序包含头，os信息，创建信息，数据大小，入口点，加载地址等等

### UBoot内存操作命令

#### md

![1526608832639.png](image/1526608832639.png)

			md.b 字节方式显示

![1526608868985.png](image/1526608868985.png)

#### mm

			mm:memory modify
			空格回车即可退出修改

![1526608998458.png](image/1526608998458.png)

![1526608898156.png](image/1526608898156.png)


### UBoot Flash操作命令

#### nand erase

![1526608980078.png](image/1526608980078.png)

#### nand write/read

![1526609030424.png](image/1526609030424.png)

			写到Flash然后再写回内存，还是可以启动内核，就完美了

![1526609158700.png](image/1526609158700.png)

![1526609209764.png](image/1526609209764.png)



#### 设置自动启动

			开机之后自动执行命令
			下载镜像或者从NandFlash提取内核镜像到内存中，然后bootm跳转执行。
			命令是写到环境变量中的，也就是UBoot启动过程中检测是否自动执行，是的话执行改命令
			该命令格式有格式，需要用 \; 间隔 多个命令之间，该分隔符前后都应该有空格
			别忘了saveenv
			重启之后自动执行

![1526609048915.png](image/1526609048915.png)

			调试阶段一般是从tftp下载镜像执行

![1526609388075.png](image/1526609388075.png)

![1526609440196.png](image/1526609440196.png)

![1526609464603.png](image/1526609464603.png)

## 总结

			文档中有给出相应写死参数

![1526609502819.png](image/1526609502819.png)

![1526609508603.png](image/1526609508603.png)

![1526609512947.png](image/1526609512947.png)
