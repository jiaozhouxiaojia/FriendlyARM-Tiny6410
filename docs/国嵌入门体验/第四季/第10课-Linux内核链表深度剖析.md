<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [第10课-Linux内核链表深度剖析](#第10课-linux内核链表深度剖析)
	- [课程索引](#课程索引)
	- [链表简介](#链表简介)
	- [链表对比](#链表对比)
	- [内核链表相关函数](#内核链表相关函数)
	- [内核链表实例](#内核链表实例)
		- [内核链表数据域定义](#内核链表数据域定义)
		- [内核链表创建](#内核链表创建)
		- [内核链表插入操作](#内核链表插入操作)
		- [内核链表遍历操作](#内核链表遍历操作)
		- [删除内核链表](#删除内核链表)
		- [植入内核模块](#植入内核模块)
	- [链表实现源码分析](#链表实现源码分析)
		- [链表初始化](#链表初始化)
		- [链表插入](#链表插入)
		- [链表移植](#链表移植)
	- [总结](#总结)

<!-- /TOC -->
# 第10课-Linux内核链表深度剖析

## 课程索引

![1526626355620.png](image/1526626355620.png)

## 链表简介

![1526646456703.png](image/1526646456703.png)

      链表最基本的元素是节点。
      包含数据域和指针域

![1526688613082.png](image/1526688613082.png)


## 链表对比

      传统链表与Linux链表区别
      传统链表：
        * 指针域是指向下一个节点的数据域
        * 节点数据必须一致
      Linux链表
        * 节点存在数据中
        * 指针域是指向下一个节点的节点域
        * 节点数据可不一致

![1526689602638.png](image/1526689602638.png)

## 内核链表相关函数

![1526689029225.png](image/1526689029225.png)

![1526689075101.png](image/1526689075101.png)

## 内核链表实例

![1526689561507.png](image/1526689561507.png)

![1526689427658.png](image/1526689427658.png)

      -c 错误，应该是-C
      -C 指定包含该目录编译

![1526689441988.png](image/1526689441988.png)

      用内核链表保存学生信息

### 内核链表数据域定义

![1526689837988.png](image/1526689837988.png)

      学生编号
      英语成绩
      数学成绩

### 内核链表创建

      INIT_LIST_HEAD

![1526697029935.png](image/1526697029935.png)

      是个内联函数，初始化链表头。要求一个指针

![1526697083743.png](image/1526697083743.png)

### 内核链表插入操作

      支持尾插入，头插入

![1526697375159.png](image/1526697375159.png)

![1526697386869.png](image/1526697386869.png)

![1526697478457.png](image/1526697478457.png)

### 内核链表遍历操作

      list_for_each

![1526697520703.png](image/1526697520703.png)

![1526697732125.png](image/1526697732125.png)

![1526697746446.png](image/1526697746446.png)

      list_for_entry(ptr,type,member)
        ptr:指向list_head的指针
        type:数据域结构类型
        member:指针域对应的类型

![1526698757526.png](image/1526698757526.png)



### 删除内核链表

![1526698779582.png](image/1526698779582.png)

![1526698934463.png](image/1526698934463.png)

![1526698951447.png](image/1526698951447.png)

### 植入内核模块

![1526699019525.png](image/1526699019525.png)

![1526699039501.png](image/1526699039501.png)


## 链表实现源码分析

### 链表初始化

![1526699145469.png](image/1526699145469.png)

![1526699170461.png](image/1526699170461.png)


### 链表插入

      头插法

![1526699182701.png](image/1526699182701.png)

![1526699385546.png](image/1526699385546.png)

![1526699448331.png](image/1526699448331.png)

![1526699467340.png](image/1526699467340.png)

![1526699489326.png](image/1526699489326.png)

      非常精妙的一个地方

### 链表移植

![1526699676115.png](image/1526699676115.png)

      内核中的代码实现直接拷贝过来

## 总结

      归功于Linux内核源码中提供的list操作，使得代码很简洁。
